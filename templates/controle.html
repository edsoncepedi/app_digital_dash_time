<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Painel de Controle - DD</title>
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='img/favicon.png') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/controle.css') }}">
</head>
<body>

    <!-- TOPBAR -->
    <header class="topbar">
      <div class="topbar-inner">
        <div class="brand">Painel de Controle</div>
        <nav class="nav">
          <a href="/supervisorio">Supervis√≥rio</a>
          <a href="/cadastro_funcionario">Funcion√°rios</a>
          <a href="/controle">Painel de Controle</a>
          <a href="/ordens">Ordens de Produ√ß√£o</a>
        </nav>
      </div>
    </header>

    <div class="container">
        <!-- Cabe√ßalho + status -->
        <div class="header">
            <div class="header-left">
                <div class="logo-wrapper">
                    <img src="../static/img/positivo.jpg" width="260" height="222" alt="Logo Positivo">
                </div>
                <div class="titulo">
                    <h1>Painel de Controle</h1>
                    <span>Monitoramento e controle da linha de produ√ß√£o</span>
                </div>
            </div>
            <div class="status-bar">
                <span class="status-label">Status da Produ√ß√£o</span>
                <div id="status-indicador">Verificando...</div>
            </div>
        </div>

        <!-- Popup central -->
        <div id="popup-aviso"></div>
        <select id="op_select">
        {% for op in ops %}
            <option value="{{ op.codigo_op }}">
            {{ op.codigo_op }} - {{ op.produto }} (meta: {{ op.meta }})
            </option>
        {% endfor %}
        </select>

        <!-- Card: valor inteiro + bot√µes -->
        <div class="card">
            <div class="card-header">
                <div>
                    <div class="card-title">Configura√ß√£o da produ√ß√£o</div>
                    <div class="card-subtitle">Informe a quantidade planejada antes de iniciar o sistema.</div>
                </div>
            </div>

            <!-- Campo n√∫mero inteiro -->
            <div class="linha-campos">
                <div class="campo">
                    <label for="ordem_select">Ordem de Produ√ß√£o</label>
                    <select id="ordem_select" name="ordem_select">
                        <option value="">-- Selecionar OP --</option>
                        {% for ordem in ops %}
                            <option
                                value="{{ ordem.codigo_op }}"
                                data-meta="{{ ordem.meta }}"
                            >
                                {{ ordem.codigo_op }} - {{ ordem.produto }}
                            </option>
                        {% endfor %}
                    </select>
                </div>

                <div class="campo">
                    <label for="meta_ordem">Meta da OP</label>
                    <input
                        type="number"
                        id="meta_ordem"
                        min="0"
                        step="1"
                        placeholder="Selecione uma OP"
                        disabled
                    >
                </div>

                <div class="campo">
                    <label for="valor-inteiro">Quantidade planejada (manual)</label>
                    <input
                        type="number"
                        id="valor-inteiro"
                        name="valor_inteiro"
                        min="1"
                        step="1"
                        placeholder="(opcional) - ser√° removido"
                        disabled
                    >
                </div>
            </div>

            <!-- Bot√µes -->
            <div class="botoes">
                <button type="button" class="btn-start" onclick="enviarComando('Start')">
                    ‚ñ∂Ô∏è <span>Iniciar Sistema</span>
                </button>
                <button type="button" class="btn-restart" onclick="enviarComando('Restart')">
                    üîÅ <span>Reiniciar Sistema</span>
                </button>
                <button type="button" class="btn-stop" onclick="enviarComando('Stop')">
                    üõë <span>Parar Sistema</span>
                </button>
            </div>

            <!-- Status de envio -->
            <div id="status">Status: <span>aguardando envio...</span></div>
        </div>

        <!-- Bloco: aloca√ß√£o de operadores -->
        <h2>Aloca√ß√£o de operadores por posto</h2>
        <div class="subtext">Cada funcion√°rio s√≥ pode ser associado a um posto por vez.</div>

        <form method="POST" action="{{ url_for('painel_controle') }}">
            <div class="linha-campos">
                {% for posto in postos %}
                <div class="campo">
                    <label for="posto_{{ posto.id }}">{{ posto.nome }}</label>
                    <select id="posto_{{ posto.id }}" name="posto_{{ posto.id }}">
                        <option value="">-- Selecionar funcion√°rio --</option>
                        {% for f in funcionarios %}
                            <option value="{{ f.id }}"
                                {% if posto.funcionario_id == f.id %}selected{% endif %}>
                                {{ f.nome }} ({{ f.rfid_tag }})
                            </option>
                        {% endfor %}
                    </select>
                </div>
                {% endfor %}
            </div>

            <div class="botoes">
                <button type="submit" class="btn-restart">
                    üíæ <span>Salvar aloca√ß√£o</span>
                </button>
            </div>
        </form>
    </div>

    <script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
    <script src="{{ url_for('static', filename='scripts/controle.js') }}" defer></script>
</body>
</html>
